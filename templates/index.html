<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Analyzer</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        body {
            background: #0a0a0f;
            min-height: 100vh;
            color: #e4e4e7;
            letter-spacing: -0.01em;
        }

        .card {
            background: #18181b;
            border: 1px solid #27272a;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            transition: border-color 0.3s;
        }

        .card:hover {
            border-color: #3f3f46;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            transition: all 0.2s;
            border: 1px solid transparent;
            cursor: pointer;
        }

        .btn-primary {
            background: #18181b;
            border-color: #3f3f46;
            color: #fafafa;
        }

        .btn-primary:hover {
            background: #27272a;
            border-color: #52525b;
        }

        .btn-primary.active {
            background: #3b82f6;
            border-color: #3b82f6;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.8125rem;
        }

        .signal-badge {
            padding: 0.375rem 0.875rem;
            border-radius: 6px;
            font-weight: 500;
            font-size: 0.75rem;
            letter-spacing: 0.025em;
            display: inline-block;
            text-transform: uppercase;
        }

        .signal-top {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .signal-bottom {
            background: rgba(16, 185, 129, 0.15);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .signal-warning {
            background: rgba(245, 158, 11, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .signal-neutral {
            background: rgba(59, 130, 246, 0.15);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .loading {
            width: 24px;
            height: 24px;
            border: 2px solid #27272a;
            border-top-color: #fafafa;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .indicator-card {
            background: #18181b;
            border: 1px solid #27272a;
            border-radius: 10px;
            padding: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .indicator-card:hover {
            border-color: #3f3f46;
            transform: translateY(-2px);
        }

        .interpretation-box {
            background: #18181b;
            border: 1px solid #27272a;
            border-left: 3px solid #3b82f6;
            padding: 1.25rem;
            margin: 1rem 0;
            border-radius: 8px;
            white-space: pre-wrap;
            line-height: 1.7;
            font-size: 0.9375rem;
            color: #d4d4d8;
        }

        .price-big {
            font-size: 3rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            line-height: 1;
        }

        h1 {
            font-weight: 600;
            letter-spacing: -0.03em;
        }

        h2, h3 {
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .divider {
            height: 1px;
            background: #27272a;
            margin: 2rem 0;
        }

        table {
            border-collapse: separate;
            border-spacing: 0;
        }

        thead tr {
            border-bottom: 1px solid #27272a;
        }

        tbody tr {
            border-bottom: 1px solid #27272a;
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        th, td {
            padding: 1rem;
            text-align: left;
        }

        th {
            font-weight: 500;
            font-size: 0.875rem;
            color: #a1a1aa;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
    </style>
</head>
<body>
    <div class="max-w-7xl mx-auto px-6 py-12">
        <!-- Header -->
        <div class="mb-12">
            <h1 class="text-4xl mb-2 text-white">Crypto Market Analyzer</h1>
            <p class="text-zinc-400 text-sm">Real-time market cycle analysis</p>
        </div>

        <!-- Coin Selector -->
        <div class="card">
            <div class="flex justify-between items-center flex-wrap gap-4">
                <div class="flex gap-3">
                    {% for coin in coins %}
                    <button onclick="loadCoin('{{ coin }}')" class="btn btn-primary" id="btn-{{ coin }}">
                        {{ coin }}
                    </button>
                    {% endfor %}
                </div>
                <div class="flex gap-3">
                    <button onclick="loadComparison()" class="btn btn-primary">
                        Compare
                    </button>
                    <button onclick="loadFearGreed()" class="btn btn-primary">
                        Sentiment
                    </button>
                    <button onclick="loadBacktest(currentSymbol)" class="btn btn-primary" id="btn-backtest">
                        Backtest
                    </button>
                </div>
            </div>
        </div>

        <!-- Time Range Selector -->
        <div class="card" id="timeRangeSelector" style="display: none;">
            <div class="flex items-center gap-3 flex-wrap">
                <span class="text-sm text-zinc-500">Time Range:</span>
                <button onclick="setTimeRange(90)" class="btn btn-primary btn-sm" data-range="90">3M</button>
                <button onclick="setTimeRange(180)" class="btn btn-primary btn-sm" data-range="180">6M</button>
                <button onclick="setTimeRange(365)" class="btn btn-primary btn-sm" data-range="365">1Y</button>
                <button onclick="setTimeRange(730)" class="btn btn-primary btn-sm active" data-range="730">2Y</button>
                <button onclick="setTimeRange(1095)" class="btn btn-primary btn-sm" data-range="1095">3Y</button>
                <button onclick="setTimeRange(1825)" class="btn btn-primary btn-sm" data-range="1825">5Y</button>
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="text-center py-16" style="display: none;">
            <div class="loading mx-auto mb-4"></div>
            <p class="text-zinc-500 text-sm">Loading...</p>
        </div>

        <!-- Content -->
        <div id="content"></div>
    </div>

    <script>
        // Global state
        let currentSymbol = 'BTC';
        let currentDays = 730;

        function getSignalClass(signal) {
            if (signal.includes('TOP') || signal.includes('OVERBOUGHT') || signal.includes('GREED')) {
                return 'signal-top';
            } else if (signal.includes('BOTTOM') || signal.includes('OVERSOLD') || signal.includes('FEAR')) {
                return 'signal-bottom';
            } else if (signal.includes('WARNING') || signal.includes('BULLISH')) {
                return 'signal-warning';
            } else {
                return 'signal-neutral';
            }
        }

        function formatPrice(price) {
            if (price >= 1000) {
                return '$' + price.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
            } else if (price >= 1) {
                return '$' + price.toFixed(2);
            } else {
                return '$' + price.toFixed(6);
            }
        }

        function formatChange(change) {
            const color = change >= 0 ? '#34d399' : '#f87171';
            const symbol = change >= 0 ? '+' : '';
            return `<span style="color: ${color}">${symbol}${change.toFixed(2)}%</span>`;
        }

        function setTimeRange(days) {
            currentDays = days;

            // Update active state on time range buttons
            document.querySelectorAll('[data-range]').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-range="${days}"]`).classList.add('active');

            // Reload current coin with new time range
            loadCoin(currentSymbol);
        }

        async function loadCoin(symbol, days = null) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').innerHTML = '';

            // Update current symbol
            currentSymbol = symbol;

            // Use provided days or fall back to currentDays
            if (days !== null) {
                currentDays = days;
            }

            // Show time range selector
            document.getElementById('timeRangeSelector').style.display = 'block';

            // Update active button
            document.querySelectorAll('#btn-BTC, #btn-ETH, #btn-SOL').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + symbol).classList.add('active');

            try:
                const response = await fetch(`/api/analyze/${symbol}?days=${currentDays}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                displayCoinAnalysis(symbol, data);
            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="card" style="border-color: #dc2626;">
                        <p style="color: #f87171;">Error: ${error.message}</p>
                    </div>
                `;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        function displayCoinAnalysis(symbol, data) {
            const current = data.current_data;
            const indicators = data.indicators;
            const charts = data.charts;

            let html = `
                <!-- Price Header -->
                <div class="card">
                    <div class="flex justify-between items-start">
                        <div>
                            <div class="text-zinc-400 text-sm mb-2">${current.name}</div>
                            <div class="price-big mb-4">${formatPrice(current.current_price)}</div>
                            <div class="flex gap-6 text-sm">
                                <div>
                                    <span class="text-zinc-500">24h</span> ${formatChange(current.price_change_24h)}
                                </div>
                                <div>
                                    <span class="text-zinc-500">7d</span> ${formatChange(current.price_change_7d)}
                                </div>
                                <div>
                                    <span class="text-zinc-500">30d</span> ${formatChange(current.price_change_30d)}
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-zinc-500 text-xs mb-1">MARKET CAP</div>
                            <div class="text-xl font-semibold">$${(current.market_cap / 1e9).toFixed(2)}B</div>
                        </div>
                    </div>
                </div>

                <!-- Assessment -->
                <div class="card" style="background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.2);">
                    <h3 class="text-lg font-semibold mb-2">Market Assessment</h3>
                    <p class="text-zinc-300">${indicators.overall_assessment}</p>
                </div>

                <!-- Price Chart -->
                <div class="card">
                    <div id="price-chart"></div>
                </div>

                <!-- Indicators Grid -->
                <div class="card">
                    <h3 class="text-xl font-semibold mb-6">Market Indicators</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            `;

            const indicatorKeys = ['pi_cycle', 'two_year_ma', 'rsi', 'rainbow', 'mayer', 'golden_ratio'];
            indicatorKeys.forEach(key => {
                const ind = indicators[key];
                html += `
                    <div class="indicator-card">
                        <div class="text-sm font-medium mb-3 text-zinc-300">${ind.name}</div>
                        <span class="signal-badge ${getSignalClass(ind.signal)}">${ind.signal}</span>
                        <p class="text-xs text-zinc-500 mt-3 leading-relaxed">${ind.interpretation.substring(0, 70)}...</p>
                    </div>
                `;
            });

            html += `
                    </div>
                </div>

                <!-- Charts Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="card">
                        <div id="pi-cycle-chart"></div>
                    </div>
                    <div class="card">
                        <div id="rsi-chart"></div>
                    </div>
                </div>

                <div class="card">
                    <div id="rainbow-chart"></div>
                </div>

                <!-- Interpretations -->
                <div class="card">
                    <h3 class="text-xl font-semibold mb-6">Analysis Details</h3>
                    <div id="interpretations"></div>
                </div>
            `;

            document.getElementById('content').innerHTML = html;

            // Render charts with dark theme
            const darkLayout = {
                paper_bgcolor: '#18181b',
                plot_bgcolor: '#18181b',
                font: { color: '#a1a1aa', family: 'Inter' }
            };

            Plotly.newPlot('price-chart', JSON.parse(charts.price_chart).data,
                {...JSON.parse(charts.price_chart).layout, ...darkLayout});
            Plotly.newPlot('pi-cycle-chart', JSON.parse(charts.pi_cycle_chart).data,
                {...JSON.parse(charts.pi_cycle_chart).layout, ...darkLayout});
            Plotly.newPlot('rsi-chart', JSON.parse(charts.rsi_chart).data,
                {...JSON.parse(charts.rsi_chart).layout, ...darkLayout});
            Plotly.newPlot('rainbow-chart', JSON.parse(charts.rainbow_chart).data,
                {...JSON.parse(charts.rainbow_chart).layout, ...darkLayout});

            // Display interpretations
            let interpHtml = '';
            indicatorKeys.forEach(key => {
                const ind = indicators[key];
                interpHtml += `
                    <div class="mb-8">
                        <h4 class="text-base font-semibold mb-3 text-zinc-200">${ind.name}</h4>
                        <div class="interpretation-box">${ind.detailed_interpretation}</div>
                    </div>
                `;
            });
            document.getElementById('interpretations').innerHTML = interpHtml;
        }

        async function loadFearGreed() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').innerHTML = '';

            // Hide time range selector
            document.getElementById('timeRangeSelector').style.display = 'none';

            try {
                const response = await fetch('/api/feargreed');
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                let html = `
                    <div class="card">
                        <h2 class="text-2xl font-semibold mb-6">Crypto Fear & Greed Index</h2>
                        <div id="fg-gauge"></div>
                    </div>

                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4">Interpretation</h3>
                        <div class="interpretation-box">${data.interpretation}</div>
                    </div>
                `;

                document.getElementById('content').innerHTML = html;

                const darkLayout = {
                    paper_bgcolor: '#18181b',
                    plot_bgcolor: '#18181b',
                    font: { color: '#a1a1aa', family: 'Inter' }
                };

                Plotly.newPlot('fg-gauge', JSON.parse(data.chart).data,
                    {...JSON.parse(data.chart).layout, ...darkLayout});

            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="card" style="border-color: #dc2626;">
                        <p style="color: #f87171;">Error: ${error.message}</p>
                    </div>
                `;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function loadComparison() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').innerHTML = '';

            // Hide time range selector
            document.getElementById('timeRangeSelector').style.display = 'none';

            try {
                const response = await fetch('/api/compare');
                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                const data = result.data;

                let html = `
                    <div class="card">
                        <h2 class="text-2xl font-semibold mb-6">Market Comparison</h2>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead>
                                    <tr>
                                        <th>Metric</th>
                                        <th>BTC</th>
                                        <th>ETH</th>
                                        <th>SOL</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                html += `
                    <tr>
                        <td class="font-medium">Price</td>
                        <td>${formatPrice(data.BTC.current.current_price)}</td>
                        <td>${formatPrice(data.ETH.current.current_price)}</td>
                        <td>${formatPrice(data.SOL.current.current_price)}</td>
                    </tr>
                    <tr>
                        <td class="font-medium">24h Change</td>
                        <td>${formatChange(data.BTC.current.price_change_24h)}</td>
                        <td>${formatChange(data.ETH.current.price_change_24h)}</td>
                        <td>${formatChange(data.SOL.current.price_change_24h)}</td>
                    </tr>
                    <tr><td colspan="4" class="py-2"></td></tr>
                `;

                const indicatorMap = {
                    'pi_cycle': 'Pi Cycle',
                    'two_year_ma': '2Y MA',
                    'rsi': 'RSI',
                    'rainbow': 'Rainbow',
                    'mayer': 'Mayer',
                    'golden_ratio': 'Golden Ratio'
                };

                for (const [key, name] of Object.entries(indicatorMap)) {
                    html += `
                        <tr>
                            <td class="font-medium">${name}</td>
                            <td>
                                <span class="signal-badge ${getSignalClass(data.BTC.indicators[key].signal)}">
                                    ${data.BTC.indicators[key].signal}
                                </span>
                            </td>
                            <td>
                                <span class="signal-badge ${getSignalClass(data.ETH.indicators[key].signal)}">
                                    ${data.ETH.indicators[key].signal}
                                </span>
                            </td>
                            <td>
                                <span class="signal-badge ${getSignalClass(data.SOL.indicators[key].signal)}">
                                    ${data.SOL.indicators[key].signal}
                                </span>
                            </td>
                        </tr>
                    `;
                }

                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                `;

                ['BTC', 'ETH', 'SOL'].forEach(symbol => {
                    html += `
                        <div class="card">
                            <div class="text-xs font-medium text-zinc-500 mb-2">${symbol}</div>
                            <p class="text-sm text-zinc-300">${data[symbol].indicators.overall_assessment}</p>
                        </div>
                    `;
                });

                html += `</div>`;

                document.getElementById('content').innerHTML = html;

            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="card" style="border-color: #dc2626;">
                        <p style="color: #f87171;">Error: ${error.message}</p>
                    </div>
                `;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        async function loadBacktest(symbol) {
            if (!symbol) {
                alert('Please select a cryptocurrency first');
                return;
            }

            document.getElementById('loading').style.display = 'block';
            document.getElementById('content').innerHTML = '';

            // Hide time range selector
            document.getElementById('timeRangeSelector').style.display = 'none';

            try {
                const response = await fetch(`/api/backtest/${symbol}`);
                const result = await response.json();

                if (result.error) {
                    throw new Error(result.error);
                }

                const backtest = result.backtest_results;
                const period = backtest.data_period;

                let html = `
                    <div class="card">
                        <h2 class="text-2xl font-semibold mb-2">Historical Backtesting: ${symbol}</h2>
                        <p class="text-sm text-zinc-500 mb-6">
                            Analysis period: ${new Date(period.start).toLocaleDateString()} - ${new Date(period.end).toLocaleDateString()}
                            (${period.days} days)
                        </p>
                        <p class="text-sm text-zinc-400 leading-relaxed">
                            This backtest analyzes how accurately each indicator predicted market tops and bottoms
                            over the past 5 years. Accuracy is measured by whether the price moved in the expected
                            direction within 90 days after the signal.
                        </p>
                    </div>

                    <!-- Pi Cycle Top Indicator -->
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                            <span>Pi Cycle Top Indicator</span>
                            <span class="text-xs px-2 py-1 rounded" style="background: rgba(239, 68, 68, 0.15); color: #f87171;">
                                TOP SIGNALS
                            </span>
                        </h3>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                            <div>
                                <div class="text-xs text-zinc-500 mb-1">Total Signals</div>
                                <div class="text-2xl font-semibold">${backtest.pi_cycle.total_signals}</div>
                            </div>
                            <div>
                                <div class="text-xs text-zinc-500 mb-1">Accuracy</div>
                                <div class="text-2xl font-semibold" style="color: ${backtest.pi_cycle.accuracy >= 60 ? '#34d399' : '#fbbf24'}">
                                    ${backtest.pi_cycle.accuracy.toFixed(1)}%
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-zinc-500 mb-1">Avg Return (30d)</div>
                                <div class="text-xl font-semibold" style="color: ${backtest.pi_cycle.avg_return_30d < 0 ? '#34d399' : '#f87171'}">
                                    ${backtest.pi_cycle.avg_return_30d >= 0 ? '+' : ''}${backtest.pi_cycle.avg_return_30d.toFixed(2)}%
                                </div>
                            </div>
                            <div>
                                <div class="text-xs text-zinc-500 mb-1">Avg Return (90d)</div>
                                <div class="text-xl font-semibold" style="color: ${backtest.pi_cycle.avg_return_90d < 0 ? '#34d399' : '#f87171'}">
                                    ${backtest.pi_cycle.avg_return_90d >= 0 ? '+' : ''}${backtest.pi_cycle.avg_return_90d.toFixed(2)}%
                                </div>
                            </div>
                        </div>
                        <div class="interpretation-box">${backtest.pi_cycle.interpretation}</div>
                `;

                // Add signal history if available
                if (backtest.pi_cycle.signals && backtest.pi_cycle.signals.length > 0) {
                    html += `
                        <div class="mt-4">
                            <div class="text-sm font-medium text-zinc-400 mb-3">Signal History</div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Price</th>
                                            <th>30d Return</th>
                                            <th>60d Return</th>
                                            <th>90d Return</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                    `;

                    backtest.pi_cycle.signals.slice(-5).forEach(signal => {
                        html += `
                            <tr>
                                <td>${new Date(signal.date).toLocaleDateString()}</td>
                                <td>${formatPrice(signal.price)}</td>
                                <td style="color: ${signal.future_returns['30d'] < 0 ? '#34d399' : '#f87171'}">
                                    ${signal.future_returns['30d'] !== undefined ? (signal.future_returns['30d'] >= 0 ? '+' : '') + signal.future_returns['30d'].toFixed(2) + '%' : 'N/A'}
                                </td>
                                <td style="color: ${signal.future_returns['60d'] < 0 ? '#34d399' : '#f87171'}">
                                    ${signal.future_returns['60d'] !== undefined ? (signal.future_returns['60d'] >= 0 ? '+' : '') + signal.future_returns['60d'].toFixed(2) + '%' : 'N/A'}
                                </td>
                                <td style="color: ${signal.future_returns['90d'] < 0 ? '#34d399' : '#f87171'}">
                                    ${signal.future_returns['90d'] !== undefined ? (signal.future_returns['90d'] >= 0 ? '+' : '') + signal.future_returns['90d'].toFixed(2) + '%' : 'N/A'}
                                </td>
                            </tr>
                        `;
                    });

                    html += `
                                    </tbody>
                                </table>
                            </div>
                            ${backtest.pi_cycle.signals.length > 5 ? '<p class="text-xs text-zinc-500 mt-2">Showing most recent 5 signals</p>' : ''}
                        </div>
                    `;
                }

                html += `</div>`;

                // Mayer Multiple
                html += `
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4">Mayer Multiple</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Top Signals -->
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="text-sm font-medium text-zinc-300">Top Signals (> 2.4)</span>
                                    <span class="text-xs px-2 py-1 rounded" style="background: rgba(239, 68, 68, 0.15); color: #f87171;">
                                        ${backtest.mayer_multiple.top_signals ? backtest.mayer_multiple.top_signals.length : 0} signals
                                    </span>
                                </div>
                                <div class="space-y-3">
                                    <div>
                                        <div class="text-xs text-zinc-500">Accuracy</div>
                                        <div class="text-xl font-semibold" style="color: ${backtest.mayer_multiple.top_accuracy >= 60 ? '#34d399' : '#fbbf24'}">
                                            ${backtest.mayer_multiple.top_accuracy.toFixed(1)}%
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-zinc-500">Avg Return (90d)</div>
                                        <div class="text-lg font-semibold" style="color: ${backtest.mayer_multiple.avg_top_return_90d < 0 ? '#34d399' : '#f87171'}">
                                            ${backtest.mayer_multiple.avg_top_return_90d >= 0 ? '+' : ''}${backtest.mayer_multiple.avg_top_return_90d.toFixed(2)}%
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Bottom Signals -->
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="text-sm font-medium text-zinc-300">Bottom Signals (< 0.8)</span>
                                    <span class="text-xs px-2 py-1 rounded" style="background: rgba(16, 185, 129, 0.15); color: #34d399;">
                                        ${backtest.mayer_multiple.bottom_signals ? backtest.mayer_multiple.bottom_signals.length : 0} signals
                                    </span>
                                </div>
                                <div class="space-y-3">
                                    <div>
                                        <div class="text-xs text-zinc-500">Accuracy</div>
                                        <div class="text-xl font-semibold" style="color: ${backtest.mayer_multiple.bottom_accuracy >= 60 ? '#34d399' : '#fbbf24'}">
                                            ${backtest.mayer_multiple.bottom_accuracy.toFixed(1)}%
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-zinc-500">Avg Return (90d)</div>
                                        <div class="text-lg font-semibold" style="color: ${backtest.mayer_multiple.avg_bottom_return_90d > 0 ? '#34d399' : '#f87171'}">
                                            ${backtest.mayer_multiple.avg_bottom_return_90d >= 0 ? '+' : ''}${backtest.mayer_multiple.avg_bottom_return_90d.toFixed(2)}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="interpretation-box mt-4">${backtest.mayer_multiple.interpretation}</div>
                    </div>
                `;

                // RSI
                html += `
                    <div class="card">
                        <h3 class="text-xl font-semibold mb-4">RSI (Relative Strength Index)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Overbought Signals -->
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="text-sm font-medium text-zinc-300">Overbought Signals (> 70)</span>
                                    <span class="text-xs px-2 py-1 rounded" style="background: rgba(239, 68, 68, 0.15); color: #f87171;">
                                        ${backtest.rsi.overbought_signals ? backtest.rsi.overbought_signals.length : 0} signals
                                    </span>
                                </div>
                                <div class="space-y-3">
                                    <div>
                                        <div class="text-xs text-zinc-500">Accuracy</div>
                                        <div class="text-xl font-semibold" style="color: ${backtest.rsi.overbought_accuracy >= 60 ? '#34d399' : '#fbbf24'}">
                                            ${backtest.rsi.overbought_accuracy.toFixed(1)}%
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-zinc-500">Avg Return (90d)</div>
                                        <div class="text-lg font-semibold" style="color: ${backtest.rsi.avg_overbought_return_90d < 0 ? '#34d399' : '#f87171'}">
                                            ${backtest.rsi.avg_overbought_return_90d >= 0 ? '+' : ''}${backtest.rsi.avg_overbought_return_90d.toFixed(2)}%
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Oversold Signals -->
                            <div>
                                <div class="flex items-center gap-2 mb-3">
                                    <span class="text-sm font-medium text-zinc-300">Oversold Signals (< 30)</span>
                                    <span class="text-xs px-2 py-1 rounded" style="background: rgba(16, 185, 129, 0.15); color: #34d399;">
                                        ${backtest.rsi.oversold_signals ? backtest.rsi.oversold_signals.length : 0} signals
                                    </span>
                                </div>
                                <div class="space-y-3">
                                    <div>
                                        <div class="text-xs text-zinc-500">Accuracy</div>
                                        <div class="text-xl font-semibold" style="color: ${backtest.rsi.oversold_accuracy >= 60 ? '#34d399' : '#fbbf24'}">
                                            ${backtest.rsi.oversold_accuracy.toFixed(1)}%
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-zinc-500">Avg Return (90d)</div>
                                        <div class="text-lg font-semibold" style="color: ${backtest.rsi.avg_oversold_return_90d > 0 ? '#34d399' : '#f87171'}">
                                            ${backtest.rsi.avg_oversold_return_90d >= 0 ? '+' : ''}${backtest.rsi.avg_oversold_return_90d.toFixed(2)}%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="interpretation-box mt-4">${backtest.rsi.interpretation}</div>
                    </div>
                `;

                // Summary
                html += `
                    <div class="card" style="background: rgba(59, 130, 246, 0.05); border-color: rgba(59, 130, 246, 0.2);">
                        <h3 class="text-lg font-semibold mb-3">Key Takeaways</h3>
                        <div class="text-sm text-zinc-300 space-y-2 leading-relaxed">
                            <p>• <strong>Pi Cycle:</strong> Specialized for identifying market tops with ${backtest.pi_cycle.accuracy.toFixed(0)}% accuracy</p>
                            <p>• <strong>Mayer Multiple:</strong> Provides both top (${backtest.mayer_multiple.top_accuracy.toFixed(0)}%) and bottom (${backtest.mayer_multiple.bottom_accuracy.toFixed(0)}%) signals</p>
                            <p>• <strong>RSI:</strong> Short-term momentum indicator with overbought (${backtest.rsi.overbought_accuracy.toFixed(0)}%) and oversold (${backtest.rsi.oversold_accuracy.toFixed(0)}%) accuracy</p>
                            <p class="text-xs text-zinc-500 mt-4">Note: Past performance does not guarantee future results. Use multiple indicators together for better decision-making.</p>
                        </div>
                    </div>
                `;

                document.getElementById('content').innerHTML = html;

            } catch (error) {
                document.getElementById('content').innerHTML = `
                    <div class="card" style="border-color: #dc2626;">
                        <p style="color: #f87171;">Error: ${error.message}</p>
                    </div>
                `;
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }

        // Load BTC by default
        window.addEventListener('load', () => {
            loadCoin('BTC');
        });
    </script>
</body>
</html>
